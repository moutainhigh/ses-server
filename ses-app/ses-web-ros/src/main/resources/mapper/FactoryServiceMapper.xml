<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.redescooter.ses.web.ros.dao.FactoryServiceMapper">
    <select id="countStatus" resultType="com.redescooter.ses.api.common.vo.CountByStatusResult">
       select ofa.status, count(*) totalCount
       from ope_factory ofa
       where ofa.dr =0
        and ofa.tenant_id = #{tenantId}
        group by ofa.status
    </select>
    <select id="listCount" resultType="int">
        select count(*)
        from ope_factory ofa
        where ofa.tenant_id = #{tenantId}
        and ofa.dr = 0
        <if test="status != null and status != ''">
            and ofa.status =#{status}
        </if>
        <if test="keyword != null and keyword != ''">
            and (
            ofa.factory_name like concat("%",#{keyword},"%")
            or ofa.factory_tag like concat("%",#{keyword},"%")
            )
        </if>
    </select>
    <select id="list" resultType="com.redescooter.ses.web.ros.vo.factory.FactoryResult">
        select id,
        status,
        factory_name,
        factory_address,
        factory_country,
        factory_longitude,
        factory_latitude,
        factory_tag,
        factory_memo,
        contact_first_name,
        contact_last_name,
        contact_full_name,
        contact_email,
        contact_phone_country_code,
        contact_phone,
        payment_cycle,
        cooperation_time_start,
        cooperation_time_end,
        business_number,
        business_license_annex,
        contract_number,
        contract_annex,
        created_by,
        created_time,
        updated_by,
        updated_time
        from ope_factory ofa
        where ofa.tenant_id = #{tenantId}
        and ofa.dr = 0
        <if test="status != null and status != ''">
            and ofa.status =#{status}
        </if>
        <if test="keyword != null and keyword != ''">
            and (
            ofa.factory_name like concat("%",#{keyword},"%")
            or ofa.factory_tag like concat("%",#{keyword},"%")
            )
        </if>
        order by ofa.updated_time desc
        limit #{startRow},#{pageSize}

    </select>
</mapper>