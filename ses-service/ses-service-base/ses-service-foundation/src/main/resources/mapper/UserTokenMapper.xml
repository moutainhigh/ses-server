<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.redescooter.ses.service.foundation.dao.UserTokenMapper">

    <select id="checkPcUser" resultType="com.redescooter.ses.api.foundation.vo.login.AccountsDto">

   select puser.ID               as userId,
          puser.TENANT_ID        as tenantId,
          puser.SYSTEM_ID        as systemId,
          puser.APP_ID           as appId,
          puser.LOGIN_NAME       as loginName,
          puser.STATUS           as status,
          puser.USER_TYPE        as userType,
          puser.LAST_LOGIN_TOKEN as lastLoginToken
     from pla_user puser
     where puser.APP_ID =#{appId}
       and puser.SYSTEM_ID = #{systemId}
       and puser.LOGIN_NAME = #{loginName}
       and puser.dr = 0

    </select>
    <select id="chectPermission" resultType="com.redescooter.ses.service.foundation.dm.base.PlaUserPermission">
    select a.Id,a.USER_ID,a.SYSTEM_ID,a.APP_ID,a.STATUS
     from user_permission a
    where a.dr = 0
     and a.USER_ID =  #{userId}
     and a.SYSTEM_ID=#{systemId}
     and a.app_id=#{appId}
    </select>
    <select id="checkAPPUser" resultType="com.redescooter.ses.api.foundation.vo.login.AccountsDto">

   select puser.ID               as userId,
          puser.TENANT_ID        as tenantId,
          puser.SYSTEM_ID        as systemId,
          puser.APP_ID           as appId,
          puser.LOGIN_NAME       as loginName,
          puser.STATUS           as status,
          puser.USER_TYPE        as userType,
          puser.LAST_LOGIN_TOKEN as lastLoginToken
     from pla_user puser
     where puser.APP_ID =#{appId}
       and puser.SYSTEM_ID = #{systemId}
       and puser.LOGIN_NAME = #{loginName}
       and puser.dr = 0

    </select>
    <update id="lockBySaaSAccount">
        update pla_user
        set STATUS ='LOCK',
        UPDATED_TIME = now()
        where STATUS <![CDATA[<>]]> 'CANCEL'
        and TENANT_ID in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </update>
    <update id="unlockBySaaSAccount">
        update user
        set STATUS ='NORMAL',
        UPDATED_TIME = now()
        where STATUS <![CDATA[<>]]> 'CANCEL'
        and TENANT_ID in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>

    </update>

</mapper>