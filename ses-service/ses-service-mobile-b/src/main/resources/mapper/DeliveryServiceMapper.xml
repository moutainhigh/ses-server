<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.redescooter.ses.service.mobile.b.dao.DeliveryServiceMapper">
    <select id="countByStatus" resultType="com.redescooter.ses.api.common.vo.CountByStatusResult">
        select status, count(*) as totalCount
        from cor_delivery delivery
        where delivery.dr = 0
        and delivery.tenant_id=#{tenantId}
        and delivery.deliverer_id=#{userId}
        <if test="statusList != null and statusList.size() != 0">
            and delivery.status in
            <foreach collection="statusList" item="item" separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
        group by delivery.status
    </select>

    <select id="deliveryList" resultType="com.redescooter.ses.api.mobile.b.vo.DeliveryDetailResult">
        select *
        from cor_delivery delivery
        where delivery.dr = 0
        and delivery.deliverer_id=#{userId}
        and delivery.tenant_id=#{tenantId}
        and delivery.status in('1','2','4','8')
        <if test="statusList != null and statusList.size() != 0">
            and delivery.status in
            <foreach collection="statusList" item="item" separator="," open="(" close=")">
                #{item}
            </foreach>
        </if>
    </select>
    <select id="refuseDelivery" resultType="java.lang.Integer">
        select count(*)
        from cor_delivery_trace
        where dr=0
        and status = #{status}
        and user_id=#{userId}
    </select>
</mapper>